{% extends "base.html" %}
{% block title %}{{ produit.nom }}{% endblock %}

{% block content %}
    <h3>ğŸ“¸ Choisir une autre image de main :</h3>
    <input type="file" id="main_file"><br><br>

    <h3>ğŸ’ Accessoire :</h3>
    <input type="file" id="accessoire_file"><br><br>

    <input type="text" id="prompt" placeholder="DÃ©cris ce que tu veux gÃ©nÃ©rer" style="width: 100%;"><br><br>
    <button onclick="envoyer()">ğŸ‘‹ Essayer sur ma main</button>

    <img id="image_result" style="width:300px; display:none;"><br>
    <p id="reponse" style="white-space: pre-wrap; font-style: italic;"></p>

    <script>
        async function envoyer() {
            const prompt = document.getElementById("prompt").value;

            const fichierMain = document.getElementById("main_file").files[0];
            const fichierAccessoire = document.getElementById("accessoire_file").files[0];

            if (!fichierMain || !fichierAccessoire) {
                alert("Merci de sÃ©lectionner les 2 images.");
                return;
            }

            const formData = new FormData();
            formData.append("main_image", fichierMain);
            formData.append("accessory_image", fichierAccessoire);
            formData.append("prompt", prompt);

            fetch("http://127.0.0.1:8000/generate_image_ai", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                console.log(data); // ğŸ‘ˆ pour dÃ©boguer si besoin

                const imageData = data.candidates?.[0]?.content?.parts?.[0]?.inline_data?.data;

                if (imageData) {
                    document.getElementById("image_result").src = "data:image/png;base64," + imageData;
                    document.getElementById("image_result").style.display = "block";
                    document.getElementById("reponse").innerText = "âœ… Image gÃ©nÃ©rÃ©e avec succÃ¨s.";
                } else {
                    const texte = data.candidates?.[0]?.content?.parts?.[0]?.text || "âŒ Aucune image gÃ©nÃ©rÃ©e.";
                    document.getElementById("reponse").innerText = texte;
                }
            })
            .catch(error => {
                document.getElementById("reponse").innerText = "Erreur : " + error;
                console.error("Erreur :", error);
            });
        }
    </script>


{% endblock %}










